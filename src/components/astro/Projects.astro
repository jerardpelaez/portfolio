---
import { getImage } from 'astro:assets';
import ProjectFilter from '../vue/ProjectFilter.vue';
import { projects as projectData } from '../../data/projects';
import gittapImage from '../../assets/images/gittap.png';
import documentPlatformImage from '../../assets/images/document-platform.png';
import productCatalogImage from '../../assets/images/product-catalog.png';
import liveGamingImage from '../../assets/images/live-gaming.png';
import corporateLearningImage from '../../assets/images/corporate-learning.png';
import financialServicesImage from '../../assets/images/financial-services.png';
import portfolioImage from '../../assets/images/portfolio.png';

const imageEntries = [
  { id: '1', src: gittapImage },
  { id: '2', src: documentPlatformImage },
  { id: '3', src: productCatalogImage },
  { id: '4', src: liveGamingImage },
  { id: '5', src: financialServicesImage },
  { id: '6', src: corporateLearningImage },
  { id: '7', src: portfolioImage },
];

const optimizedImages = await Promise.all(
  imageEntries.map(async (entry) => {
    const optimized = await getImage({ src: entry.src, format: 'webp', width: 800, quality: 80 });
    return { id: entry.id, src: optimized.src };
  })
);

const imageMap: Record<string, string> = {};
optimizedImages.forEach(({ id, src }) => { imageMap[id] = src; });

const projects = projectData.map(p => ({
  ...p,
  image: imageMap[p.id],
}));
---

<section id="projects" class="py-20 md:py-32 bg-dark-deep relative overflow-hidden">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
    <!-- Header -->
    <div class="text-center mb-16 reveal">
      <span class="inline-block text-primary font-semibold mb-4">My Work</span>
      <h2 class="text-3xl sm:text-4xl md:text-5xl font-bold text-dark-text mb-6">
        Featured Projects
      </h2>
      <p class="text-lg text-dark-muted max-w-2xl mx-auto">
        A selection of enterprise projects I've contributed to as part of cross-functional teams,
        showcasing frontend development expertise and collaborative delivery.
      </p>
    </div>

    <!-- Project Filter (Vue Component) -->
    <ProjectFilter projects={projects} client:visible />
  </div>
</section>
